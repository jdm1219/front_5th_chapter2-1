import"./modulepreload-polyfill-B5Qt9EMX.js";const T=(t,n)=>{const e={p1:.1,p2:.15,p3:.2,p4:.05,p5:.25};return n>=10&&e[t]?e[t]:0},s=(()=>{const t={productList:[{id:"p1",name:"상품1",price:1e4,quantity:50},{id:"p2",name:"상품2",price:2e4,quantity:30},{id:"p3",name:"상품3",price:3e4,quantity:20},{id:"p4",name:"상품4",price:15e3,quantity:0},{id:"p5",name:"상품5",price:25e3,quantity:10}],cartList:[],get itemTotal(){return this.cartList.reduce((e,c)=>{const o=this.productList.find(({id:a})=>a===c.id),i=T(o.id,c.quantity),r=o.price*c.quantity*(1-i);return e+r},0)},totalPrice:0,itemCount:0,discountRate:0,get bonusPoint(){return Math.floor(this.totalPrice/1e3)},lastSelectedItem:null},n=new Map;return{get(e){return t[e]},set(e,c){t[e]=c,n.has(e)&&n.get(e).forEach(o=>o(c))},subscribe(e,c){n.has(e)||n.set(e,[]),n.get(e).push(c)}}})(),C=30,p=.25,E=2,L=.1,q=(t,n)=>{const e={p1:.1,p2:.15,p3:.2,p4:.05,p5:.25};return n>=10&&e[t]?e[t]:0},m=()=>{let t=0,n=0;const e=s.get("cartList");console.log(e);let c=0,o=0;e.forEach(i=>{const r=S(i.id);if(!r)return;const a=i.quantity,d=r.price*a,l=q(r.id,a);t+=d*(1-l),n+=a,c+=d}),{totalPrice:t,discRate:o}=$(t,n,c,o),{totalPrice:t,discRate:o}=v(t,o),s.set("totalPrice",t),s.set("itemCount",n),s.set("discountRate",o)},S=t=>s.get("productList").find(e=>e.id===t),$=(t,n,e,c)=>{if(e===0)return{totalPrice:t,discRate:c};if(c=(e-t)/e,n>=C){const i=e*p,r=e-t;i>r&&(t=e*(1-p),c=p)}return{totalPrice:t,discRate:c}},v=(t,n)=>(new Date().getDay()===E&&(t*=1-L,n=Math.max(n,L)),{totalPrice:t,discRate:n}),y=t=>{const n=s.get("productList"),e=s.get("cartList"),c=n.find(({id:i})=>i===t),o=e.find(({id:i})=>i===t);if(!c||c.quantity<1){alert("재고가 부족합니다.");return}c.quantity--,o?(o.price=c.price,o.quantity++):e.push({...c,quantity:1}),s.set("productList",[...n]),s.set("cartList",[...e]),m()},x=()=>{const t=document.getElementById("product-select").value;y(t)},D=t=>{const n=t.target.dataset.productId;y(n)},A=t=>{const n=s.get("productList"),e=s.get("cartList"),c=t.target.dataset.productId,o=n.find(r=>r.id===c),i=e.find(r=>r.id===c);if(i.quantity--,o.quantity++,i.quantity===0){const r=e.filter(a=>a.id!==c);s.set("cartList",r)}else s.set("cartList",[...e]);s.set("productList",[...n]),m()},M=t=>{const n=s.get("productList"),e=s.get("cartList"),c=t.target.dataset.productId,o=n.find(a=>a.id===c),i=e.find(a=>a.id===c);o.quantity+=i.quantity;const r=e.filter(a=>a.id!==c);s.set("cartList",r),s.set("productList",[...n]),m()};function N(){const t=Object.assign(document.createElement("div"),{id:"cart-items",className:"my-4"}),n=()=>{const e=s.get("cartList");t.innerHTML=`${e.map(({id:r,name:a,price:d,quantity:l})=>`<div id="${r}" class="flex justify-between items-center mb-2">
              <span>${a} - ${d}원 x ${l}</span>
              <div>
                <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="${r}" data-change="-1">-</button>
                <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="${r}" data-change="1">+</button>
                <button class="remove-item bg-red-500 text-white px-2 py-1 rounded" data-product-id="${r}">삭제</button>
              </div>
            </div>
          `).join("")}
  `;const c=t.querySelectorAll('button[data-change="1"]'),o=t.querySelectorAll('button[data-change="-1"]'),i=t.querySelectorAll(".remove-item");c.forEach(r=>{r.addEventListener("click",D)}),o.forEach(r=>{r.addEventListener("click",A)}),i.forEach(r=>{r.addEventListener("click",M)})};return s.subscribe("cartList",n),n(),t}function w(){const t=Object.assign(document.createElement("div"),{id:"cart-total",className:"text-xl font-bold my-4"}),n=()=>{const e=s.get("totalPrice"),c=s.get("discountRate"),o=Math.floor(e/1e3);t.innerHTML=`총액: ${Math.round(e)}원${c>0?`<span class="text-green-500 ml-2">(${(c*100).toFixed(1)}% 할인 적용)</span>`:""}<span id="loyalty-points" class="text-blue-500 ml-2">(포인트: ${o})</span></div>
    `};return s.subscribe("totalPrice",n),s.subscribe("discountRate",n),n(),t}function O(){const t=Object.assign(document.createElement("select"),{id:"product-select",className:"border rounded p-2 mr-2"}),n=()=>{var o;const e=s.get("productList"),c=((o=document.querySelector("#product-select"))==null?void 0:o.value)||"";t.innerHTML=`${e.map(({id:i,quantity:r,name:a,price:d})=>`<option value="${i}" ${r===0?"disabled":""} ${i===c?"selected":""}>${a} - ${d}원</option>`).join("")}
    `};return n(),s.subscribe("productList",n),t}function _(){const t=Object.assign(document.createElement("button"),{id:"add-to-cart",className:"bg-blue-500 text-white px-4 py-2 rounded"});return(()=>{t.innerHTML="추가",t.addEventListener("click",x)})(),t}function R(){const t=Object.assign(document.createElement("div"),{id:"stock-status",className:"text-sm text-gray-500 mt-2"}),n=()=>{const e=s.get("productList");t.innerHTML=`${e.filter(c=>c.quantity<5).map(c=>`${c.name}: ${c.quantity>0?`재고 부족 (${c.quantity}개 남음)`:"품절"}`)}`};return s.subscribe("productList",n),n(),t}async function h(t){return new Promise(n=>setTimeout(n,t))}const u={SECOND:1e3,MINUTE:60*1e3},g=.2,f=.05,b=(t,n)=>Math.round(t*n),I=t=>`${100*t}%`,U=async()=>{await h(10*u.SECOND*Math.random()),setInterval(()=>{const t=s.get("productList");if(!(Math.random()<.3))return;const e=Math.floor(t.length*Math.random()),c=t[e];c.quantity<=0||(c.price=b(c.price,g),alert(`번개세일! ${c.name}이(가) ${I(g)} 할인 중입니다!`),s.set("productList",[...t]))},30*u.SECOND)},P=async()=>{await h(20*u.SECOND*Math.random()),setInterval(()=>{const t=s.get("productList"),n=s.get("lastSelectedItem");if(!n)return;const e=t.find(c=>c.id!==n&&c.quantity>0);e&&(e.price=b(e.price,f),alert(`${e.name}은(는) 어떠세요? 지금 구매하시면 ${I(f)} 추가 할인!`),s.set("productList",[...t]))},u.MINUTE)};function B(){const t=document.getElementById("app");(()=>{t.innerHTML=`
    <div class="bg-gray-100 p-8">
      <div id="wrap" class="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl p-8">
        <h1 class="text-2xl font-bold mb-4">장바구니</h1>
      </div>  
      </div>
    `;const e=t.querySelector("#wrap");e.appendChild(N()),e.appendChild(w()),e.appendChild(O()),e.appendChild(_()),e.appendChild(R())})(),U(),P()}function j(){B()}j();
